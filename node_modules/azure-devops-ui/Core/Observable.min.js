import*as tslib_1 from"tslib";import*as React from"react";var Observable=function(){function e(){this.observers={},this.subscriberCount=0}return e.prototype.notify=function(e,t,r){if(this.observers[t])for(var s=this.observers[t].slice(),n=0;n<s.length;n++)s[n](e,t);if(this.observers[""])for(var s=this.observers[""].slice(),n=0;n<s.length;n++)s[n](e,t);r&&(this.events||(this.events=[]),this.events.push({action:t,value:e}))},e.prototype.subscribe=function(e,t){if(t=t||"",this.observers[t]||(this.observers[t]=[]),this.observers[t].push(e),this.subscriberCount++,this.events)for(var r=0,s=this.events;r<s.length;r++){var n=s[r];t&&n.action!==t||e(n.value,n.action)}},e.prototype.unsubscribe=function(e,t){if(t=t||"",this.observers[t]){var r=this.observers[t].indexOf(e);r>=0&&(this.observers[t].splice(r,1),this.subscriberCount--)}},e}();export{Observable};export var ObservableLike;!function(e){function t(e){return e&&"function"==typeof e.subscribe}e.isObservable=t,e.getValue=function(e){return t(e)?e.value:e},e.subscribe=function(e,r,s){t(e)&&e.subscribe(r,s)},e.unsubscribe=function(e,r,s){t(e)&&e.unsubscribe(r,s)}}(ObservableLike||(ObservableLike={}));var ObservableValue=function(e){function t(t){var r=e.call(this)||this;return r.v=t,r}return tslib_1.__extends(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.v},set:function(e){this.v=e,this.notify(this.v,"set")},enumerable:!0,configurable:!0}),t}(Observable);export{ObservableValue};var ObservableObject=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.objects={},t}return tslib_1.__extends(t,e),t.prototype.add=function(e,t){this.objects.hasOwnProperty(e)||(this.objects[e]=t,this.notify({key:e,value:t},"add"))},t.prototype.get=function(e){return this.objects[e]},t.prototype.keys=function(){return Object.keys(this.objects)},t}(Observable);export{ObservableObject};var ObservableArray=function(e){function t(t){void 0===t&&(t=[]);var r=e.call(this)||this;return r.internalItems=t||[],r}return tslib_1.__extends(t,e),t.prototype.change=function(e){for(var t,r=[],s=1;s<arguments.length;s++)r[s-1]=arguments[s];return(t=this.internalItems).splice.apply(t,[e,r.length].concat(r)),this.notify({index:e,changedItems:r},"change"),r.length},Object.defineProperty(t.prototype,"length",{get:function(){return this.internalItems.length},enumerable:!0,configurable:!0}),t.prototype.push=function(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];if(t.length){var s=this.internalItems.length;(e=this.internalItems).push.apply(e,t),this.notify({addedItems:t,index:s},"push")}return t.length},t.prototype.pop=function(){var e=this.internalItems.pop();return void 0!==e&&this.notify({index:0,removedItems:[e]},"pop"),e},t.prototype.removeAll=function(e){for(var t=[],r=[],s=0,n=this.internalItems;s<n.length;s++){var i=n[s];!e||e(i)?t.push(i):r.push(i)}return t.length>0&&(this.internalItems=r,this.notify({index:0,removedItems:t},"removeAll")),t},t.prototype.splice=function(e,t){for(var r,s=[],n=2;n<arguments.length;n++)s[n-2]=arguments[n];var i=(r=this.internalItems).splice.apply(r,[e,t].concat(s));return this.notify({addedItems:s,index:e,removedItems:i},"splice"),i},Object.defineProperty(t.prototype,"value",{get:function(){return this.internalItems},set:function(e){this.splice.apply(this,[0,this.length].concat(e))},enumerable:!0,configurable:!0}),t}(Observable);export{ObservableArray};var ObservableCollection=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.collections=[],t.items=[],t}return tslib_1.__extends(t,e),Object.defineProperty(t.prototype,"length",{get:function(){return this.items.length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this.items},enumerable:!0,configurable:!0}),t.prototype.push=function(e,t){var r,s;if(ObservableLike.isObservable(e)){var n=e,i=this.getSubscriber(this.collections.length,t);s={items:n.value,observable:n,subscriber:i},this.subscriberCount&&ObservableLike.subscribe(s.observable,i)}else e.length&&(s={items:e});if(s&&(this.collections.push(s),s.items.length)){var o=this.transformItems(s.items,t);(r=this.items).push.apply(r,o),this.subscriberCount&&this.notify({addedItems:o,index:this.items.length-o.length},"push")}},t.prototype.subscribe=function(t,r){if(e.prototype.subscribe.call(this,t,r),1===this.subscriberCount)for(var s=0,n=this.collections;s<n.length;s++){var i=n[s];i.subscriber&&i.observable.subscribe(i.subscriber)}},t.prototype.unsubscribe=function(t,r){if(e.prototype.unsubscribe.call(this,t,r),0===this.subscriberCount)for(var s=0,n=this.collections;s<n.length;s++){var i=n[s];i.subscriber&&i.observable.unsubscribe(i.subscriber)}},t.prototype.transformItems=function(e,t){var r;if(e)if(t){r=[];for(var s=0,n=e;s<n.length;s++){var i=t(n[s]);void 0!==i&&r.push(i)}}else r=e;else r=[];return r},t.prototype.getSubscriber=function(e,t){var r=this;return function(s){for(var n,i,o=s.index,a=0;a<e;a++)o+=r.collections[e].items.length;if(s.changedItems){var l=r.transformItems(s.changedItems,t);(n=r.items).splice.apply(n,[o,s.changedItems.length].concat(l)),r.notify({changedItems:l,index:o},"change")}else{var u=r.transformItems(s.removedItems,t),b=r.transformItems(s.addedItems,t);(i=r.items).splice.apply(i,[o,u.length].concat(b)),r.notify({removedItems:u,addedItems:b,index:o},"splice")}}},t}(Observable);export{ObservableCollection};var ReadyableObservableArray=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.ready=new ObservableValue(!1),t}return tslib_1.__extends(t,e),t}(ObservableArray);export{ReadyableObservableArray};export function useObservable(e){var t=React.useState(e)[0],r=React.useState(new ObservableValue(t));return[r[0],function(e){r[0].value="function"==typeof e?e(r[0].value):e}]};export function useObservableArray(e){var t=React.useState(e)[0],r=React.useState(new ObservableArray(t));return[r[0],function(e){r[0].value="function"==typeof e?e(r[0].value):e}]};