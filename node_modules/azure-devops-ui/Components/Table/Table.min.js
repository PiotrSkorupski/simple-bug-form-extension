function getVariableLength(){return 80*Math.random()+20+"%"}import*as tslib_1 from"tslib";import"../../CommonImports";import"../../Core/core.css";import"./Table.css";import*as React from"react";import*as Resources from"../../Resources.Widgets";import{ObservableLike}from"../../Core/Observable";import{FocusWithin}from"../../FocusWithin";import{FocusZone,FocusZoneContext}from"../../FocusZone";import{Icon}from"../../Icon";import{Intersection}from"../../Intersection";import{List,renderListCell}from"../../List";import{Observer}from"../../Observer";import{Sizer}from"../../Sizer";import{css}from"../../Util";import{EventDispatch}from"../../Utilities/Dispatch";import{getTabIndex}from"../../Utilities/Focus";export var ColumnFill={columnLayout:0,id:"_fill",renderCell:function(e,t){return React.createElement("td",{key:"col-fill","aria-colindex":t,className:css("bolt-table-cell bolt-list-cell","col-"+t),"data-column-index":t})},renderHeaderCell:function(e,t){return React.createElement("td",{key:"col-fill",className:css(t.headerClassName,"bolt-table-header-cell bolt-table-header-cell-empty","col-header-"+e),"data-column-index":e})},width:-100};var Table=function(e){function t(t){var r=e.call(this,t)||this;r.list=React.createRef(),r.onColumnsChanged=function(){return r.forceUpdate(),!1},r.renderHeader=function(){for(var e=r.props,t=e.columns,l=e.showHeader,n=e.renderHeader,o=e.spacerWidth,a=[],c=0,i=0;i<t.length;i++){(s=ObservableLike.getValue(t[i].width))<0&&(c+=s)}for(i=0;i<t.length;i++){var s=ObservableLike.getValue(t[i].width);a[i]=s>=0?s:-s/c*100}return React.createElement(React.Fragment,null,React.createElement("colgroup",null,React.createElement("col",{key:"col-group-left-spacer",style:{width:0===o?o+"%":o+"px"}}),t.map(function(e,t){return React.createElement(Observer,{key:"col-group-"+t,width:{filter:r.onColumnsChanged,observableValue:e.width}},function(){return React.createElement("col",{style:{width:Math.abs(a[t])+(a[t]<0?"%":"px")}})})}),React.createElement("col",{key:"col-group-right-spacer",style:{width:0===o?o+"%":o+"px"}})),l?n?n(t):React.createElement(TableHeader,{tableColumns:t}):null)},r.renderLoadingRow=function(e,t){var l=r.props,n=l.columns,o=l.renderLoadingRow,a={ariaBusy:!0,data:t.data,eventDispatch:r.state.eventDispatch,excludeTabStop:t.excludeTabStop,itemProvider:r.props.itemProvider,listProps:t.listProps,onFocusItem:t.onFocusItem,renderSpacer:r.props.renderSpacer,selection:r.props.selection,singleClickActivation:r.props.singleClickActivation};return o?o(e,a):React.createElement(TableRow,{className:"bolt-list-row-loading",details:a,index:e},n.map(function(e,t){return SimpleTableCell({columnIndex:t,children:renderLoadingCell(e.columnLayout)})}))},r.renderRow=function(e,t,l){var n={eventDispatch:r.state.eventDispatch,data:l.data,excludeTabStop:l.excludeTabStop,itemProvider:r.props.itemProvider,listProps:l.listProps,onFocusItem:l.onFocusItem,renderSpacer:r.props.renderSpacer,selection:r.props.selection,singleClickActivation:r.props.singleClickActivation},o=t.renderRow||r.props.renderRow;return o?o(e,t,n):React.createElement(TableRow,{details:n,index:e},r.props.columns.map(function(r,l){return r.renderCell(e,l,r,t)}))},r.state={columnBehaviors:[],tableBehaviors:[],eventDispatch:t.eventDispatch||new EventDispatch,tableWidth:""};for(var l=0;l<t.columns.length;l++){var n=t.columns[l];if(n.behaviors)for(var o=0,a=n.behaviors;o<a.length;o++){(s=a[o])&&s.initialize&&s.initialize({tableProps:t,columnIndex:l},{},r.state.eventDispatch)}}if(t.behaviors)for(var c=0,i=t.behaviors;c<i.length;c++){var s=i[c];s.initialize&&s.initialize(t,r,r.state.eventDispatch)}return r}return tslib_1.__extends(t,e),t.getDerivedStateFromProps=function(e,t){for(var r=[],l=[],n=0;n<e.columns.length;n++){var o=e.columns[n];if(o.behaviors)for(var a=0,c=o.behaviors;a<c.length;a++){var i=c[a];l.push(i)}}return e.behaviors&&r.splice.apply(r,[r.length,0].concat(e.behaviors)),{columnBehaviors:l,tableBehaviors:r}},t.prototype.render=function(){for(var e=this.state.eventDispatch,t=this.props,r=t.className,l=t.columns,n=t.containerClassName,o=t.focuszoneProps,a=t.showLines,c=t.id,i=t.itemProvider,s=t.onActivate,m=t.onFocus,d=t.onSelect,u=t.pageSize,p=t.role,h=t.rowHeight,b=t.scrollable,v=t.selection,f=t.singleClickActivation,R=t.virtualize,g=2*(this.props.spacerWidth||0),x=g,w=g,E=g,C=!1,y=!1,N=0,S=l;N<S.length;N++){var I=S[N],k=I.maxWidth,F=I.minWidth,z=ObservableLike.getValue(I.width);z<0?(y=!0,w+=F||0,k&&(C=!0,x+=k)):(E+=z,w+=z,x+=z)}var D={className:css(r,"bolt-table",a&&"bolt-table-show-lines"),columnCount:l.length+2,eventDispatch:e,focuszoneProps:o,id:c,itemProvider:i,maxWidth:C?x+"px":void 0,minWidth:w!==E?w+"px":void 0,onActivate:s,onFocus:m,onSelect:d,pageSize:u,renderHeader:this.renderHeader,renderLoadingRow:this.renderLoadingRow,renderRow:this.renderRow,role:p,rowHeight:h,selection:v,singleClickActivation:f,virtualize:R,width:y?"100%":E+"px"},L=React.createElement("div",{className:css(n,"bolt-table-container flex-grow",b&&"scroll-auto")},React.createElement(List,tslib_1.__assign({},D,{ref:this.list})));return b&&(L=React.createElement(Intersection,{rootMargin:window.innerHeight/2},L)),L},t.prototype.componentDidMount=function(){for(var e=0,t=this.state.tableBehaviors;e<t.length;e++){(n=t[e]).componentDidMount&&n.componentDidMount(this.props)}for(var r=0,l=this.state.columnBehaviors;r<l.length;r++){var n=l[r];n.componentDidMount&&n.componentDidMount({tableProps:this.props})}},t.prototype.componentDidUpdate=function(){for(var e=0,t=this.state.tableBehaviors;e<t.length;e++){(n=t[e]).componentDidUpdate&&n.componentDidUpdate(this.props)}for(var r=0,l=this.state.columnBehaviors;r<l.length;r++){var n=l[r];n.componentDidUpdate&&n.componentDidUpdate({tableProps:this.props})}},t.prototype.componentWillUnmount=function(){for(var e=0,t=this.state.tableBehaviors;e<t.length;e++){(n=t[e]).componentWillUnmount&&n.componentWillUnmount()}for(var r=0,l=this.state.columnBehaviors;r<l.length;r++){var n=l[r];n.componentDidUpdate&&n.componentDidUpdate({tableProps:this.props})}},t.prototype.addOverlay=function(e,t,r,l){if(void 0===l&&(l=0),this.list.current)return this.list.current.addOverlay(e,t,r,l)},t.prototype.removeOverlay=function(e){if(this.list.current)return this.list.current.removeOverlay(e)},t.prototype.getFocusIndex=function(){return this.list.current?this.list.current.getFocusIndex():-1},t.prototype.scrollIntoView=function(e,t){if(this.list.current)return this.list.current.scrollIntoView(e,t)},t.defaultProps={role:"grid",showHeader:!0,showLines:!0,singleClickActivation:!0,spacerWidth:8},t}(React.Component);export{Table};var TableHeader=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return tslib_1.__extends(t,e),t.prototype.render=function(){var e=this;return React.createElement(FocusZoneContext.Consumer,null,function(t){return React.createElement(FocusZone,{direction:1},React.createElement("thead",null,React.createElement(FocusWithin,null,function(r){return React.createElement("tr",{className:css("bolt-table-header-row",r.hasFocus&&"focused"),"data-row-index":-1,onBlur:r.onBlur,onFocus:r.onFocus},React.createElement("td",{key:"left-spacer",role:"presentation"}),e.props.tableColumns.map(function(e,r){return e.renderHeaderCell?e.renderHeaderCell(r,e,t.focuszoneId):e.iconProps||e.name?React.createElement(TableHeaderCell,{key:"col-header-"+r,column:e,columnIndex:r,focuszoneId:t.focuszoneId},React.createElement("div",{className:"bolt-table-header-cell-text text-ellipsis"},e.iconProps&&Icon(e.iconProps),e.name)):React.createElement("td",{key:"col-header-"+r})}),React.createElement("td",{key:"right-spacer",role:"presentation"}))}),React.createElement("tr",{className:"bolt-table-header-row","data-row-index":-1},React.createElement("td",{key:"left-spacer",className:"bolt-table-header-spacer",role:"presentation"}),e.props.tableColumns.map(function(e,t){return React.createElement("td",{key:"col-header-"+t,className:css("bolt-table-header-spacer","col-header-"+t),role:"presentation"})}),React.createElement("td",{key:"right-spacer",className:"bolt-table-header-spacer",role:"presentation"}))))})},t}(React.Component),TableHeaderCell=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.element=React.createRef(),t.state={measuredWidth:0},t.onSize=function(e,r){var l=t.props.column;l.onSize&&l.onSize(e,t.props.columnIndex,r,l)},t}return tslib_1.__extends(t,e),t.prototype.render=function(){var e,t=this,r=this.props,l=r.column,n=r.columnIndex,o=r.focuszoneId;return l.onSize&&(e=React.createElement(Observer,{width:l.width},function(e){var r=e.width;return r<0&&(r=t.state.measuredWidth),React.createElement(Sizer,{className:"bolt-table-header-sizer",divider:!1,maxSize:l.maxWidth,minSize:l.minWidth,onSize:t.onSize,onSizeEnd:t.props.column.onSizeEnd,orientation:0,position:0,size:r})})),React.createElement(FocusZoneContext.Consumer,null,function(r){var a=l.behaviors&&l.behaviors.length>0||!!l.sortProps,c=l.sortProps,i=void 0===c?{}:c,s=i.ariaLabelAscending,m=void 0===s?Resources.SortedAscending:s,d=i.ariaLabelDescending,u=void 0===d?Resources.SortedDescending:d;return React.createElement("td",{className:css(l.headerClassName,"bolt-table-header-cell","col-header-"+n),"data-column-index":n,ref:t.element,role:"columnheader"},React.createElement("div",{className:css("bolt-table-header-cell-content flex-row",a&&"bolt-table-header-cell-actionable"),"data-focuszone":a&&css(0===n&&o,r.focuszoneId),tabIndex:a&&0===n?0:-1},e,t.props.children,l.sortProps&&void 0!==i.sortOrder?Icon({ariaLabel:0===i.sortOrder?m:u,className:"bolt-table-header-sort-icon",iconName:0===i.sortOrder?"SortUp":"SortDown"}):null))})},t.prototype.componentDidMount=function(){this.updateMeasuredWidth()},t.prototype.componentDidUpdate=function(){this.updateMeasuredWidth()},t.prototype.updateMeasuredWidth=function(){var e=this.props.column;if(e.onSize&&this.element.current&&ObservableLike.getValue(e.width)<0){var t=this.element.current.getBoundingClientRect().width;t!==this.state.measuredWidth&&this.setState({measuredWidth:t})}},t}(React.Component);export{TableHeaderCell};var TableRow=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.rowElement=React.createRef(),t.onFocus=function(e){t.props.details.onFocusItem(t.props.index,e)},t.onPostprocessKeyStroke=function(e){return e.defaultPrevented||37===e.which&&t.rowElement.current&&(t.rowElement.current.focus(),e.preventDefault()),1},t}return tslib_1.__extends(t,e),t.prototype.render=function(){var e=this,t=this.props,r=t.details,l=t.index,n=r.ariaLabel,o=r.ariaBusy,a=r.excludeFocusZone,c=r.renderSpacer,i=r.role,s=r.selection,m=r.singleClickActivation;return React.createElement(FocusWithin,{onFocus:this.onFocus},function(t){return React.createElement(FocusZoneContext.Consumer,null,function(d){return React.createElement(FocusZone,{direction:1,postprocessKeyStroke:e.onPostprocessKeyStroke},React.createElement("tr",{"aria-busy":o,"aria-label":n,"aria-rowindex":l+1,"aria-selected":s&&s.selected(l),className:css(e.props.className,"bolt-table-row bolt-list-row",0===l&&"first-row",t.hasFocus&&"focused",s&&s.selected(l)&&"selected",m&&"single-click-activation"),"data-focuszone":a?void 0:d.focuszoneId,"data-row-index":e.props.index,role:i,tabIndex:getTabIndex(r),onBlur:t.onBlur,onFocus:t.onFocus,ref:e.rowElement},React.createElement("td",{key:"left-spacer",className:"bolt-table-cell-compact bolt-table-cell bolt-list-cell bolt-table-spacer-cell",role:"presentation"},c&&c(l,!0)),e.props.children,React.createElement("td",{key:"right-spacer",className:"bolt-table-cell-compact bolt-table-cell bolt-list-cell bolt-table-spacer-cell",role:"presentation"},c&&c(l,!1))))})})},t}(React.Component);export{TableRow};export function TableCell(e){var t=e.className,r=e.colspan,l=e.columnIndex,n=e.tableColumn;return React.createElement("td",{key:"col-"+l,"aria-colindex":l,className:css(t,n&&n.className,"bolt-table-cell bolt-list-cell"),colSpan:r,"data-column-index":l},e.children)};export function SimpleTableCell(e){return TableCell({children:React.createElement("div",{className:css(e.contentClassName,"bolt-table-cell-content flex-row flex-center")},e.children),className:e.className,colspan:e.colspan,columnIndex:e.columnIndex,tableColumn:e.tableColumn})};export function TwoLineTableCell(e){var t,r="bolt-table-two-line-cell-item flex-row scroll-hidden",l=React.createElement("div",{className:r},e.line1),n=React.createElement("div",{className:r},e.line2),o=React.createElement(React.Fragment,null,l,n);return t=e.iconProps?React.createElement("div",{className:css(e.className,"bolt-table-cell-content flex-row flex-center")},Icon(tslib_1.__assign({},e.iconProps,{className:css(e.iconProps.className,"bolt-table-two-line-cell-icon flex-noshrink")})),React.createElement("div",{className:"flex-column scroll-hidden"},o)):React.createElement("div",{className:css(e.className,"bolt-table-cell-content flex-column")},o),TableCell({children:t,colspan:e.colspan,columnIndex:e.columnIndex,className:"bolt-table-two-line-cell",tableColumn:e.tableColumn})};export function renderEmptyCell(e,t){return React.createElement(TableCell,{columnIndex:t,key:t})};export function renderSimpleCell(e,t,r,l){return renderSimpleCellValue(t,r,l[r.id])};export function renderSimpleCellValue(e,t,r){var l=t.columnStyle,n=!(!r||"string"==typeof r||"number"==typeof r||!r.href);return React.createElement(SimpleTableCell,{className:css(2===l&&"bolt-table-cell-primary",1===l&&"bolt-table-cell-secondary",3===l&&"bolt-table-cell-tertiary"),columnIndex:e,contentClassName:n?"bolt-table-cell-content-with-link":void 0,key:e,tableColumn:t},r&&renderListCell(r))};export function renderLoadingCell(e){return 1===e||void 0===e?React.createElement("div",{className:"shimmer shimmer-line",style:{width:getVariableLength()}}," "):2===e?React.createElement(React.Fragment,null,React.createElement("div",{className:"shimmer shimmer-circle-small flex-noshrink"}),React.createElement("div",{className:"shimmer shimmer-line",style:{width:getVariableLength()}}," ")):3===e?React.createElement("div",{className:"flex-column flex-grow"},React.createElement("div",{className:"bolt-table-two-line-cell-item shimmer shimmer-line",style:{width:getVariableLength()}}," "),React.createElement("div",{className:"bolt-table-two-line-cell-item shimmer shimmer-line",style:{width:getVariableLength()}}," ")):4===e?React.createElement(React.Fragment,null,React.createElement("div",{className:"shimmer shimmer-circle-large flex-noshrink"}),React.createElement("div",{className:"flex-column flex-grow"},React.createElement("div",{className:"bolt-table-two-line-cell-item shimmer shimmer-line",style:{width:getVariableLength()}}," "),React.createElement("div",{className:"bolt-table-two-line-cell-item shimmer shimmer-line",style:{width:getVariableLength()}}," "))):null};