import * as tslib_1 from "tslib";
import "../../CommonImports";
import "../../Core/core.css";
import "./IdentityCard.css";
import * as React from "react";
import * as Resources from '../../Resources.Persona';
import { Callout } from '../../Callout';
import { FocusZone } from '../../FocusZone';
import { Spinner } from '../../Spinner';
import { css } from '../../Util';
import { ContactCard } from "./ContactCard";
import { DefaultAbridgedCard } from "./DefaultAbridgedCard";
import { DefaultCard } from "./DefaultCard";
import { DefaultSimpleCard } from "./DefaultSimpleCard";
import { GitHubCard } from "./GitHubCard";
import { GroupCard } from "./GroupCard";
import { GroupMembersCard } from "./GroupMembersCard";
import { IdentityCardHeaderElement as HeaderElement } from "./IdentityCardHeaderElement";
import * as Utils from "./IdentityCardIdentityUtils";
import { OrganizationCard } from "./OrganizationCard";
/**
 * The content of the callout for the persona card.
 */
var IdentityCardContent = /** @class */ (function (_super) {
    tslib_1.__extends(IdentityCardContent, _super);
    function IdentityCardContent() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.onKeyDown = function (ev) {
            if (ev.which === 27 /* escape */) {
                _this.onDismissCallout();
                ev.preventDefault();
            }
        };
        // State change helper methods
        _this.onDismissCallout = function () {
            if (_this.props.onDismissCallback) {
                _this.props.onDismissCallback();
            }
        };
        return _this;
    }
    // Render
    IdentityCardContent.prototype.render = function () {
        // Get target element
        var targetElement = this.props.referenceHTMLComponent ? this.props.referenceHTMLComponent : this.props.target;
        // Use component state information to render component
        return (React.createElement("div", null,
            React.createElement(Callout, { onDismiss: this.onDismissCallout, anchorElement: targetElement, anchorOrigin: { horizontal: "end" /* end */, vertical: "start" /* start */ }, calloutOrigin: { horizontal: "start" /* start */, vertical: "start" /* start */ }, ariaLabel: Resources.IdentityCardProfileCardAriaLabel, role: "alert", className: "bolt-identity-card-callout depth-8", lightDismiss: true },
                React.createElement("div", null, this.renderCard()))));
    };
    IdentityCardContent.prototype.renderCard = function () {
        var cssClassName = "bolt-identity-card";
        if (this.props.working && !Utils.isCompleteIdentity(this.props.dataProps.identity)) {
            // Still working to get initial data
            return (React.createElement("div", { className: css(cssClassName, "loading") },
                React.createElement(Spinner, { label: Resources.Loading, size: "large" /* large */, className: "bolt-identity-card-loading-spinner" })));
        }
        var isAdOrAadOrGroup = Utils.isAdUser(this.props.dataProps.identity) ||
            Utils.isAadUser(this.props.dataProps.identity) ||
            Utils.isGroup(this.props.dataProps.identity);
        var headerIdentity = this.props.dataProps.header || undefined;
        var innerCard = this.renderInnerCard();
        return innerCard ? (React.createElement(FocusZone, { circularNavigation: true, direction: 2 /* Vertical */, focusOnMount: true, handleTabKey: true },
            React.createElement("div", { className: cssClassName, onKeyDown: this.onKeyDown },
                isAdOrAadOrGroup && headerIdentity && React.createElement(HeaderElement, { identity: headerIdentity, onClickFunction: this.props.onHeaderClick }),
                innerCard))) : (React.createElement("div", null));
    };
    IdentityCardContent.prototype.renderInnerCard = function () {
        // Get component state data
        var _a = this.props.dataProps, identity = _a.identity, successors = _a.successors, managerList = _a.managerList, directReportList = _a.directReportList;
        if (!identity) {
            return React.createElement("div", null);
        }
        var isGroup = Utils.isGroup(identity);
        var isVsdUser = Utils.isVsdUser(identity);
        var isWmdUser = Utils.isWmdUser(identity);
        var isAadUser = Utils.isAadUser(identity);
        var isAdUser = Utils.isAdUser(identity);
        var isGithubUser = Utils.isGithubUser(identity);
        if (isGroup) {
            switch (this.props.dataProps.cardType) {
                case 2 /* Organization */:
                    return React.createElement(GroupMembersCard, { identity: identity, members: successors, onClickEntity: this.props.onClickEntity });
                case 0 /* Default */:
                    return (React.createElement(GroupCard, { identity: identity, isPreviousHeader: !!this.props.dataProps.previousDataState || !!this.props.initialHeader, members: successors, showOrganizationCard: this.props.onShowOrganizationCard }));
            }
        }
        else if (isGithubUser) {
            return React.createElement(GitHubCard, { identity: identity });
        }
        else if (isVsdUser) {
            return React.createElement(DefaultAbridgedCard, { identity: identity });
        }
        else if (isWmdUser) {
            return React.createElement(DefaultSimpleCard, { identity: identity });
        }
        else if (isAadUser || isAdUser) {
            switch (this.props.dataProps.cardType) {
                case 1 /* Contact */:
                    return React.createElement(ContactCard, { identity: identity });
                case 2 /* Organization */:
                    return (React.createElement(OrganizationCard, { identity: identity, managerList: managerList, directReportList: directReportList, onClickEntity: this.props.onClickEntity }));
                case 0 /* Default */:
                default:
                    var manager = managerList && managerList.length > 0 ? managerList[managerList.length - 1] : undefined;
                    return (React.createElement(DefaultCard, { identity: identity, manager: manager, isPreviousHeader: !!this.props.dataProps.previousDataState || !!this.props.initialHeader, showContactCard: this.props.onShowContactCard, showOrganizationCard: this.props.onShowOrganizationCard, onClickEntity: this.props.onClickEntity }));
            }
        }
        return React.createElement("div", null);
    };
    return IdentityCardContent;
}(React.Component));
export { IdentityCardContent };
