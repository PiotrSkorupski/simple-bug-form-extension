import*as tslib_1 from"tslib";import"../../CommonImports";import"../../Core/core.css";import"./Tree.css";import"./TreeExpand.css";import*as React from"react";import{ObservableLike}from"../../Core/Observable";import{FocusWithin}from"../../FocusWithin";import{FocusZone,FocusZoneContext}from"../../FocusZone";import{renderListCell}from"../../List";import{Observer}from"../../Observer";import{renderLoadingCell,SimpleTableCell,Table}from"../../Table";import{css,preventDefault}from"../../Util";import{getTabIndex}from"../../Utilities/Focus";import{TreeExpand}from"./TreeExpand";var Tree=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.table=React.createRef(),t.renderRow=function(e,r,o){return React.createElement(Observer,{data:r.underlyingItem.data},function(n){if(n.data){r.onToggle=r.underlyingItem.childItems?t.props.onToggle:void 0;var l=r.underlyingItem.data.renderRow||t.props.renderRow;return l?l(e,r,o):React.createElement(TreeRow,{index:e,details:o},t.props.columns.map(function(t,o){return t.renderCell(e,o,t,r)}))}var a=t.props.renderLoadingRow;return a?a(e,o):React.createElement(TreeRow,{index:e,details:o},t.props.columns.map(function(e,t){var r=renderLoadingCell(e.columnLayout);return e.hierarchical&&(r=React.createElement(TreeExpand,{depth:o.data.depth},r)),SimpleTableCell({className:"bolt-tree-cell",columnIndex:t,children:r})}))})},t}return tslib_1.__extends(t,e),t.prototype.render=function(){var e=this.props.role,t=void 0===e?"treegrid":e;return React.createElement(Table,{behaviors:this.props.behaviors,className:this.props.className,columns:this.props.columns,containerClassName:this.props.containerClassName,eventDispatch:this.props.eventDispatch,focuszoneProps:this.props.focuszoneProps,id:this.props.id,itemProvider:this.props.itemProvider,onActivate:this.props.onActivate,onFocus:this.props.onFocus,onSelect:this.props.onSelect,pageSize:this.props.pageSize,renderHeader:this.props.renderHeader,renderRow:this.renderRow,renderSpacer:this.props.renderSpacer,role:t,rowHeight:this.props.rowHeight,ref:this.table,scrollable:this.props.scrollable,selection:this.props.selection,singleClickActivation:this.props.singleClickActivation,showHeader:this.props.showHeader,showLines:this.props.showLines,virtualize:this.props.virtualize})},t.prototype.addOverlay=function(e,t,r,o){if(void 0===o&&(o=0),this.table.current)return this.table.current.addOverlay(e,t,r,o)},t.prototype.removeOverlay=function(e){if(this.table.current)return this.table.current.removeOverlay(e)},t.prototype.getFocusIndex=function(){return this.table.current?this.table.current.getFocusIndex():-1},t.prototype.scrollIntoView=function(e,t){if(this.table.current)return this.table.current.scrollIntoView(e,t)},t}(React.Component);export{Tree};var TreeRow=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.rowElement=React.createRef(),t.onFocus=function(e){t.props.details.onFocusItem(t.props.index,e)},t.onKeyDown=function(e){if(!e.defaultPrevented&&t.rowElement.current===e.nativeEvent.srcElement){var r=t.props.details.data;if(r&&r.onToggle){var o=r.underlyingItem.expanded;(39===e.which&&!o||37===e.which&&o)&&(r.onToggle(e,r),e.preventDefault())}}},t.onPostprocessKeyStroke=function(e){return e.defaultPrevented||37===e.which&&(t.rowElement.current.focus(),e.preventDefault()),1},t}return tslib_1.__extends(t,e),t.prototype.render=function(){var e=this,t=this.props,r=t.details,o=t.index,n=r.data,l=r.excludeFocusZone,a=r.renderSpacer,s=r.selection,i=r.singleClickActivation;return React.createElement(FocusWithin,{onFocus:this.onFocus},function(t){return React.createElement(FocusZoneContext.Consumer,null,function(c){return React.createElement(FocusZone,{direction:1,postprocessKeyStroke:e.onPostprocessKeyStroke},React.createElement("tr",{"aria-busy":void 0===n,"aria-expanded":ObservableLike.getValue(n&&n.underlyingItem.expanded||!1),"aria-level":n?n.depth:void 0,"aria-rowindex":o+1,"aria-selected":s&&s.selected(o),className:css(e.props.className,"bolt-tree-row bolt-table-row bolt-list-row",0===o&&"first-row",t.hasFocus&&"focused",s&&s.selected(o)&&"selected",i&&"single-click-activation"),"data-focuszone":l?void 0:c.focuszoneId,"data-row-index":o,tabIndex:getTabIndex(r),onBlur:t.onBlur,onFocus:t.onFocus,onKeyDown:e.onKeyDown,ref:e.rowElement},React.createElement("td",{key:"left-spacer",className:"bolt-table-cell-compact bolt-table-cell bolt-list-cell",role:"presentation"},a&&a(o,!0)),e.props.children,React.createElement("td",{key:"right-spacer",className:"bolt-table-cell-compact bolt-table-cell bolt-list-cell",role:"presentation"},a&&a(o,!1))))})})},t}(React.Component);export{TreeRow};export function ExpandableTreeCell(e){var t=e.colspan,r=e.columnIndex,o=e.contentClassName,n=e.treeItem,l=e.treeColumn,a=n.depth,s=n.onToggle,i=n.underlyingItem.expanded,c=React.createElement(TreeExpand,{expanded:i,depth:a,indentationSize:l&&l.indentationSize,onClick:preventDefault,onToggle:s?function(e){return s(e,n)}:void 0},e.children);return SimpleTableCell({children:c,className:css(e.className,"bolt-tree-cell"),colspan:t,columnIndex:r,contentClassName:o,tableColumn:l})};export function renderExpandableTreeCell(e,t,r,o){var n=o.underlyingItem,l=ObservableLike.getValue(n.data),a=l&&l[r.id],s=!(!a||"string"==typeof a||"number"==typeof a||!a.href);return ExpandableTreeCell({children:a&&renderListCell(a),className:r.className,columnIndex:t,contentClassName:s?"bolt-table-cell-content-with-link":void 0,treeItem:o,treeColumn:r})};export function renderTreeCell(e,t,r,o){var n=o.underlyingItem,l=ObservableLike.getValue(n.data),a=l&&l[r.id],s=!(!a||"string"==typeof a||"number"==typeof a||!a.href);return SimpleTableCell({className:r.className,children:a&&renderListCell(a),columnIndex:t,contentClassName:s?"bolt-table-cell-content-with-link":void 0,tableColumn:r})};