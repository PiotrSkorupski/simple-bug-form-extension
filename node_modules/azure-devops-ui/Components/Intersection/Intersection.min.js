import*as tslib_1 from"tslib";import"../../CommonImports";import"../../Core/core.css";import*as React from"react";import{shimRef}from"../../Util";for(var threshold=[],index=0;index<=100;index++)threshold.push(index/100);var IntersectionContextImpl=function(){function t(){var t=this;this.callbacks=[],this.pending=[],this.rootMargin=0,this.root=document.body,this.onIntersect=function(e){if(t.observer)for(var o=0,n=t.callbacks;o<n.length;o++){(0,n[o])(e,t.observer)}}}return t.prototype.connect=function(t,e){void 0===e&&(e=0),this.observer=new IntersectionObserver(this.onIntersect,{root:t,rootMargin:e+"px",threshold:threshold}),this.rootMargin=e,this.root=t;for(var o=0,n=this.pending;o<n.length;o++){var r=n[o];this.observer.observe(r)}},t.prototype.disconnect=function(){this.observer&&this.observer.disconnect()},t.prototype.observe=function(t){this.observer?this.observer.observe(t):this.pending.push(t)},t.prototype.register=function(t){this.callbacks.push(t)},t.prototype.unobserve=function(t){var e=this.pending.indexOf(t);e>=0&&this.pending.splice(e,1),this.observer&&this.observer.unobserve(t)},t.prototype.unregister=function(t){var e=this.callbacks.indexOf(t);e>=0&&this.callbacks.splice(e,1)},t}();export var IntersectionContext=React.createContext(new IntersectionContextImpl);var Intersection=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.state=new IntersectionContextImpl,e.onScroll=function(t){e.state.onIntersect([])},e}return tslib_1.__extends(e,t),e.prototype.render=function(){var t=this,e=React.Children.only(this.props.children);this.props.rootElement||(this.rootElement=shimRef(e));var o;return o=e.props.onScroll?function(o){e.props.onScroll&&e.props.onScroll(o),t.onScroll(o)}:this.onScroll,React.createElement(IntersectionContext.Provider,{value:this.state},React.cloneElement(e,tslib_1.__assign({},e.props,{ref:this.rootElement,onScroll:o}),e.props.children))},e.prototype.componentDidMount=function(){var t=this.props.rootElement,e=null;t?(e="string"==typeof t?document.querySelector(t):"function"==typeof t?t():t)&&(e.addEventListener("scroll",this.onScroll),this.externalElement=e):this.rootElement&&(e=this.rootElement.current),e&&(this.state.connect(e,this.props.rootMargin),this.props.onIntersect&&this.state.register(this.props.onIntersect))},e.prototype.componentWillUnmount=function(){this.externalElement&&this.externalElement.removeEventListener("scroll",this.onScroll),this.state.disconnect()},e}(React.Component);export{Intersection};