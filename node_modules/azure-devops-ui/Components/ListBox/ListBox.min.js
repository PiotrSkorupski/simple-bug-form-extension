import*as tslib_1 from"tslib";import"../../CommonImports";import"../../Core/core.css";import"./ListBox.css";import*as React from"react";import{ObservableLike}from"../../Core/Observable";import*as Utils_Accessibility from"../../Core/Util/Accessibility";import{format}from"../../Core/Util/String";import{renderListCell}from"../../List";import{ItemsObserver,Observer}from"../../Observer";import*as Resources from"../../Resources.Dropdown";import{Spinner}from"../../Spinner";import{ColumnSelect,renderEmptyCell,SimpleTableCell,Table,TableRow}from"../../Table";import{css}from"../../Util";import{DropdownSelection}from"../../Utilities/DropdownSelection";import{ArrayItemProvider,getItemsValue}from"../../Utilities/Provider";export var DefaultListBoxWidth=-100;var ListBox=function(e){function t(t){var s=e.call(this,t)||this;return s.tabbableIndex=-1,s.positions=[],s.count=0,s.loadingChanged=function(){return ObservableLike.getValue(s.props.loading)?Utils_Accessibility.announce(Resources.AnnounceLoadingItems):Utils_Accessibility.announce(Resources.AnnounceFinishedLoadingItems),!0},s.searchingChanged=function(){if(ObservableLike.getValue(s.props.loading))Utils_Accessibility.announce(Resources.Searching);else{var e=s.props.items.length;Utils_Accessibility.announce(e>0?format(Resources.AnnounceFilterResultCount,e):Resources.NoFilterResults,!0)}return!0},s.onItemsChanged=function(){var e=getListBoxItemsValue(s.props.items,s.wrappedItems);s.tabbableIndex=-1,s.positions=[],s.count=0;for(var t=0,o=e;t<o.length;t++){var n=o[t],i=ObservableLike.getValue(n);!i||3!==i.type&&2!==i.type?(-1===s.tabbableIndex&&s.selection.selectable(s.positions.length)&&(s.tabbableIndex=s.positions.length),s.positions.push(++s.count)):s.positions.push(-1)}return!0},s.onActivate=function(e,t){s.props.onActivate&&s.props.onActivate(e,t.data)},s.onSelect=function(e,t){s.props.onSelect&&s.props.onSelect(e,t.data)},s.renderListBoxRow=function(e,t,o){var n=s.props.excludeTabStop,i=s.selection.selectable(e),r=tslib_1.__assign({},o,{ariaPosInSet:s.positions[e]>=0?s.positions[e]:null,ariaSetSize:s.positions[e]>=0?s.count:null,excludeTabStop:n||s.tabbableIndex!==e,excludeFocusZone:!i,singleClickActivation:!1});return React.createElement(Observer,{key:e,item:t},function(){return React.createElement(TableRow,{key:e,index:e,details:r,className:css(2===t.type&&"bolt-list-box-header-row",3===t.type&&"bolt-list-box-divider-row",s.selection.multiSelect&&"bolt-list-box-multi-select-row",2!==t.type&&3!==t.type&&"cursor-pointer")},s.columns.map(function(o,n){return s.selection.multiSelect&&0===n&&!i?3===t.type?null:renderEmptyCell(e,n):o.renderCell(e,n,o,t)}))})},s.renderListBoxCell=function(e,t,o,n){return n.render?n.render(e,t,o,n):3===n.type?React.createElement(SimpleTableCell,{className:css(o.className,n.className,s.selection.multiSelect&&"bolt-list-box-divider-multi-select"),columnIndex:t,colspan:2,key:t,tableColumn:o},React.createElement("div",{className:"bolt-list-box-divider flex-grow"})):React.createElement(SimpleTableCell,{className:css(o.className,n.className,2===n.type&&"bolt-list-box-header"),columnIndex:t,key:t,tableColumn:o},n&&renderListCell(n))},s.selection=t.selection||new DropdownSelection,s.columns=s.selection.multiSelect?[new ColumnSelect]:[],s.columns.push({id:"text",width:s.props.width,renderCell:s.props.renderItem||s.renderListBoxCell,className:css("bolt-list-box-text",s.selection.multiSelect?"bolt-list-box-text-multi-select":"bolt-list-box-text-single-select")}),s.wrappedItems=wrapListBoxItems(s.props.items),s.onItemsChanged(),s}return tslib_1.__extends(t,e),t.prototype.render=function(){var e=this,t=this.props,s=t.className,o=t.containerClassName,n=t.focuszoneProps,i=t.getUnselectableRanges,r=t.items,l=t.loading,a=t.searching,c={observableValue:r,filter:this.onItemsChanged},m=this.wrappedItems?new ArrayItemProvider(this.wrappedItems):Array.isArray(r)?new ArrayItemProvider(r):r;return React.createElement(ItemsObserver,{getUnselectableRanges:i,items:r,selection:this.selection},React.createElement(Observer,{items:c,loading:{observableValue:l||!1,filter:this.loadingChanged},searching:{observableValue:a||!1,filter:this.searchingChanged}},function(t){return t.loading||t.searching?React.createElement("div",{className:"bolt-list-box-loading"},React.createElement(Spinner,{size:"medium",label:t.loading?Resources.Loading:Resources.Searching})):React.createElement(Table,{className:css(s,"bolt-list-box"),columns:e.columns,containerClassName:o,focuszoneProps:n,itemProvider:m,onActivate:e.onActivate,onSelect:e.onSelect,renderRow:e.renderListBoxRow,scrollable:!0,singleClickActivation:!1,selection:e.selection,showHeader:!1,showLines:!1,spacerWidth:0})}))},t.defaultProps={getUnselectableRanges:getUnselectableRanges,width:DefaultListBoxWidth},t}(React.Component);export{ListBox};export function getUnselectableRanges(e,t){void 0===t&&(t=listBoxItemSelectable);for(var s=[],o=-1,n=0;n<e.length;n++)!t(e[n])&&o<0?o=n:t(e[n])&&o>=0&&(s.push({beginIndex:o,endIndex:n-1}),o=-1);return o>=0&&s.push({beginIndex:o,endIndex:e.length-1}),s};export function listBoxItemSelectable(e){return 2!==e.type&&3!==e.type};export function wrapListBoxItems(e){if(Array.isArray(e)&&e.length&&"string"==typeof e[0])return e.map(function(e){return{id:e,text:e}})};export function getListBoxItemsValue(e,t){return $DEBUG&&Array.isArray(e)&&e.length&&"string"==typeof e[0]&&void 0===t&&console.warn("a string[] was passed for items and not wrapped first.  Call wrapListBoxItems on items and pass in the results as wrappedItems."),t||getItemsValue(e)};