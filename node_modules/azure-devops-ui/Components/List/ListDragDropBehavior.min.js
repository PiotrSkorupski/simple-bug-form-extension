import"../../CommonImports";import"../../Core/core.css";import"./List.css";import"./ListDropIndicator.css";import{noop}from"../../Util";import{dispatchCustomDragEvent}from"../../Utilities/DragDrop";import{cellFromEvent}from"./List";import{ListDragSourceBehavior}from"./ListDragSourceBehavior";import{ListDropTargetBehavior}from"./ListDropTargetBehavior";var ListDragDropBehavior=function(){function t(t){var e=this;this.initialize=function(t,o,r){e.eventDispatch=r,e.itemProvider=t.itemProvider,e.eventDispatch.addEventListener("keydown",e.onKeyDown),e.dragBehavior.initialize(t,o,r),e.dropBehavior.initialize(t,o,r)},this.onDragRowKeyDown=function(t){27===t.which?e.endDrag(t):32===t.which?e.endDrag(t,!0):40===t.which?(e.focusIndex=Math.min(e.focusIndex+1,e.itemProvider.length),e.fireRowDragEvents(t)):38===t.which&&(e.focusIndex=Math.max(e.focusIndex-1,0),e.fireRowDragEvents(t)),t.preventDefault()},this.onKeyDown=function(t){if(!t.defaultPrevented&&32===t.which){var o=cellFromEvent(t).rowIndex;e.focusIndex=o;var r=e.itemProvider.value[o];e.dataTransfer={data:r,dropEffect:"none",secondaryData:{index:o,sourceId:e.options.id},setDragImage:noop,type:e.options.type},dispatchCustomDragEvent("dragstart",t.target,t.nativeEvent,e.dataTransfer),"none"!==e.dataTransfer.effectAllowed&&(e.dragItemRowElement=t.target,e.dragItemRowElement.addEventListener("keydown",e.onDragRowKeyDown))}},this.options=t,this.dragBehavior=new ListDragSourceBehavior(t),this.dropBehavior=new ListDropTargetBehavior(t)}return t.prototype.componentDidUpdate=function(t){this.itemProvider=t.itemProvider,this.dragBehavior.componentDidUpdate(t),this.dropBehavior.componentDidUpdate(t)},t.prototype.componentWillUnmount=function(){this.eventDispatch.removeEventListener("keydown",this.onKeyDown),this.dragItemRowElement&&this.dragItemRowElement.removeEventListener("keydown",this.onDragRowKeyDown),this.dragBehavior.componentWillUnmount(),this.dropBehavior.componentWillUnmount()},t.prototype.dispatchEventAtIndex=function(t,e,o,r){for(var i=e;i&&!i.classList.contains("bolt-list");)i=i.parentElement;if(i){var n=i.querySelector("[data-row-index='"+r+"']");n&&dispatchCustomDragEvent(t,n,o,this.dataTransfer)}},t.prototype.endDrag=function(t,e){void 0===e&&(e=!1),dispatchCustomDragEvent("dragend",t.target,t,this.dataTransfer),e?this.dispatchEventAtIndex("drop",t.target,t,this.focusIndex):this.dispatchEventAtIndex("dragexit",t.target,t,this.focusIndex),this.dragItemRowElement&&(this.dragItemRowElement.removeEventListener("keydown",this.onDragRowKeyDown),this.dragItemRowElement=void 0)},t.prototype.fireRowDragEvents=function(t){this.dispatchEventAtIndex("dragenter",t.target,t,this.focusIndex),this.dispatchEventAtIndex("dragover",t.target,t,this.focusIndex)},t}();export{ListDragDropBehavior};