import"../../CommonImports";import"../../Core/core.css";import"./List.css";import"./ListDropIndicator.css";import*as React from"react";import{getPointByEventType}from"../../Util";import{cellFromEvent}from"./List";import{ListDropIndicator}from"./ListDropIndicator";var ListDropTargetBehavior=function(){function t(t){var e=this;this.initialize=function(t,r,o){e.dragDroppableUI=r,e.eventDispatch=o,e.eventDispatch.addEventListener("dragenter",e.onDragEnter),e.eventDispatch.addEventListener("dragexit",e.onDragExit),e.eventDispatch.addEventListener("dragover",e.onDragOver),e.eventDispatch.addEventListener("drop",e.onDrop),e.itemProvider=t.itemProvider},this.onDragEnter=function(t){e.handlesType(t)&&(e.options.onDragEnter?e.options.onDragEnter(t):t.detail.dataTransfer.dropEffect="move")},this.onDragExit=function(t){e.handlesType(t)&&(e.options.onDragExit&&e.options.onDragExit(t),e.dragDroppableUI.removeOverlay("drop-indicator"))},this.onDragOver=function(t){if(e.handlesType(t)){var r=e.calculateIndex(t),o=t.detail.dataTransfer.secondaryData.index,i=t.detail.dataTransfer.secondaryData.sourceId;r>=0&&(r!==o||i!==e.options.id)?e.options.onDragOver?e.options.onDragOver(t,{index:0===e.listIndicatorPosition?r+1:r}):t.detail.dataTransfer.dropEffect="move":t.detail.dataTransfer.dropEffect="none","none"===t.detail.dataTransfer.dropEffect?e.dragDroppableUI.removeOverlay("drop-indicator"):e.dragDroppableUI.addOverlay("drop-indicator",r,e.renderDropIndicator)}},this.onDrop=function(t){if(e.handlesType(t)){var r=e.calculateIndex(t),o=t.detail.dataTransfer.secondaryData.index,i=t.detail.dataTransfer.secondaryData.sourceId;r>=0&&(r!==o||i!==e.options.id)&&e.options.onDrop&&e.options.onDrop(t,{index:0===e.listIndicatorPosition?r+1:r}),e.dragDroppableUI.removeOverlay("drop-indicator")}},this.renderDropIndicator=function(t){return React.createElement(ListDropIndicator,{position:e.listIndicatorPosition})},this.options=t}return t.prototype.componentDidUpdate=function(t){this.itemProvider=t.itemProvider},t.prototype.componentWillUnmount=function(){this.eventDispatch.removeEventListener("dragenter",this.onDragEnter),this.eventDispatch.removeEventListener("dragexit",this.onDragExit),this.eventDispatch.removeEventListener("dragover",this.onDragOver),this.eventDispatch.removeEventListener("drop",this.onDrop)},t.prototype.calculateIndex=function(t){var e=cellFromEvent(t),r=e.rowIndex;if(e.rowElement&&t.detail.dataTransfer.secondaryData){var o=t.detail.dataTransfer.secondaryData.index,i=t.detail.dataTransfer.secondaryData.sourceId,n=t.detail.nativeEvent,a=e.rowElement.getBoundingClientRect(),s=getPointByEventType(n),d=s?s.y<a.height/2+a.top:r<o;this.options.id!==i?(this.listIndicatorPosition=1,d||r++,r>=this.itemProvider.length&&(this.listIndicatorPosition=0,r--)):r<o?(this.listIndicatorPosition=1,d||r++):r>o&&(this.listIndicatorPosition=0,d&&r--)}return r},t.prototype.handlesType=function(t){var e=t.detail.dataTransfer.type||"";return-1!==this.options.allowedTypes.indexOf(e)},t}();export{ListDropTargetBehavior};