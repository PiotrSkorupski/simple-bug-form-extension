import*as tslib_1 from"tslib";import"../../CommonImports";import"../../Core/core.css";import"./Callout.css";import*as React from"react";import{FocusWithin}from"../../FocusWithin";import{FocusZone}from"../../FocusZone";import{Portal}from"../../Portal";import{css,getSafeId}from"../../Util";import{position,updateLayout}from"../../Utilities/Position";import{SurfaceContext}from"../../Surface";var Callout=function(t){function o(){var o=null!==t&&t.apply(this,arguments)||this;return o.calloutContent=React.createRef(),o}return tslib_1.__extends(o,t),o.prototype.render=function(){var t=this.props.portalProps;return React.createElement(Portal,tslib_1.__assign({},t,{className:css(t&&t.className,this.props.anchorElement&&"bolt-layout-relative")}),React.createElement(CalloutContent,tslib_1.__assign({ref:this.calloutContent},this.props)))},o.prototype.componentWillUnmount=function(){this.calloutContent.current&&this.calloutContent.current.portalWillUnmount()},o.prototype.updateLayout=function(){this.calloutContent.current&&this.calloutContent.current.updateLayout()},o.defaultProps={blurDismiss:!1},o}(React.Component);export{Callout};var CalloutContent=function(t){function o(o){var e=t.call(this,o)||this;return e.calloutElement=React.createRef(),e.contentElement=React.createRef(),e.scrollListen=!1,e.scrollEvent=null,e.onBlur=function(){e.props.onDismiss&&e.props.onDismiss()},e.onClick=function(t){e.props.lightDismiss&&!t.defaultPrevented&&(e.props.onDismiss&&e.props.onDismiss(),t.preventDefault())},e.onKeyDown=function(t){e.props.escDismiss&&27===t.which&&!t.defaultPrevented&&(e.props.onDismiss&&e.props.onDismiss(),t.preventDefault())},e.onResize=function(){e.props.onDismiss&&e.props.onDismiss()},e.onScroll=function(t){e.scrollListen&&(e.scrollEvent=t.nativeEvent)},e.onScrollDocument=function(t){e.scrollListen&&(t===e.scrollEvent?e.scrollEvent=null:e.props.onDismiss&&e.props.onDismiss())},e.focusElement=document.activeElement,e}return tslib_1.__extends(o,t),o.prototype.render=function(){var t,o=this,e=this.props,n=e.contentJustification,s=e.contentLocation,i=e.contentOrientation,r=(e.contentSize,e.lightDismiss),l=e.modal,c=e.anchorElement;this.props.blurDismiss&&this.props.focuszoneProps?t=React.createElement(FocusWithin,{onBlur:this.onBlur,updateStateOnFocusChange:!1},function(t){return React.createElement(FocusZone,tslib_1.__assign({},o.props.focuszoneProps),o.renderContent(t.onFocus,t.onBlur))}):(t=this.renderContent(),this.props.blurDismiss&&(t=React.createElement(FocusWithin,{onBlur:this.onBlur,updateStateOnFocusChange:!1},t)),this.props.focuszoneProps&&(t=React.createElement(FocusZone,tslib_1.__assign({},this.props.focuszoneProps),t)));var a=r?React.createElement("div",{className:css("absolute-fill bolt-light-dismiss",l&&"bolt-callout-modal"),onClick:this.onClick}):null;return React.createElement(SurfaceContext.Provider,{value:{background:2}},React.createElement("div",{className:"flex-row flex-grow"},React.createElement("div",{"aria-describedby":getSafeId(this.props.ariaDescribedBy),"aria-label":this.props.ariaLabel,"aria-labelledby":getSafeId(this.props.ariaLabelledBy),className:css(this.props.className,"bolt-callout absolute",void 0!==s&&"absolute-fill",0===n&&"justify-start",1===n&&"justify-center",2===n&&"justify-end",0===s&&"flex-start",1===s&&"flex-center",2===s&&"flex-end",0===i&&"flex-column",0!==i&&"flex-row",l&&!r&&"bolt-callout-modal"),id:getSafeId(this.props.id),onKeyDown:this.onKeyDown,ref:this.calloutElement},!c&&a,t),!!c&&a))},o.prototype.componentDidMount=function(){this.updateLayout(),this.props.anchorElement&&(window.addEventListener("resize",this.onResize),document.addEventListener("scroll",this.onScrollDocument,!0),this.scrollListen=!0)},o.prototype.componentDidUpdate=function(){this.props.updateLayout&&this.updateLayout()},o.prototype.componentWillUnmount=function(){this.scrollListen&&(document.removeEventListener("scroll",this.onScrollDocument,!0),window.removeEventListener("resize",this.onResize))},o.prototype.portalWillUnmount=function(){var t=this.contentElement.current,o=this.focusElement;o&&t&&t.contains(document.activeElement)&&window.setTimeout(function(){(t.contains(document.activeElement)||document.activeElement===document.body||null===document.activeElement)&&o.focus()},0)},o.prototype.updateLayout=function(){void 0===this.props.contentLocation&&this.calloutElement.current&&(position(this.calloutElement.current,this.props.calloutOrigin||{horizontal:"start",vertical:"start"},this.props.anchorOffset,this.props.anchorElement,this.props.anchorOrigin,this.props.anchorPoint),this.props.fixedLayout||updateLayout(this.calloutElement.current,this.props.calloutOrigin||{horizontal:"start",vertical:"start"},this.props.anchorOffset,this.props.anchorElement,this.props.anchorOrigin,this.props.anchorPoint))},o.prototype.renderContent=function(t,o){var e=this.props,n=e.contentJustification,s=e.contentOrientation,i=e.contentSize;return React.createElement("div",{className:css(this.props.contentClassName,"bolt-callout-content",this.props.contentShadow&&"bolt-callout-shadow",3===n&&"flex-grow",0===s&&"flex-column",1===s&&"flex-row",0===i&&"bolt-callout-small",1===i&&"bolt-callout-medium",2===i&&"bolt-callout-large"),onBlur:o,onFocus:t,onScroll:this.onScroll,ref:this.contentElement,role:this.props.role||"dialog"},this.props.children)},o}(React.Component);