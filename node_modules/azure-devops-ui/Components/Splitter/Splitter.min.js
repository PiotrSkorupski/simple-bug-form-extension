import*as tslib_1 from"tslib";import"../../CommonImports";import"../../Core/core.css";import"./Splitter.css";import*as React from"react";import{EventManagement}from"../../Core/EventManagement";import{css}from"../../Util";var DIVIDER_MOVE_INCREMENT=20,DIVIDER_WIDTH=4,Splitter=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r._onDividerKeyDown=function(e){var t=r.props,i=t.disabled,n=t.splitterDirection;if(!i&&!r._isDragging){switch(e.keyCode){case 37:0===n&&r._moveDivider(0);break;case 39:0===n&&r._moveDivider(1);break;case 38:1===n&&r._moveDivider(0);break;case 40:1===n&&r._moveDivider(1);break;default:return}e.preventDefault(),e.stopPropagation()}},r._onDividerMouseDown=function(e){var t=r.props.disabled,i=r.state.fixedSize;if(r._fixedRef&&!t){e.preventDefault(),e.stopPropagation(),r._dragAnchorPos=r._getEventBoundedClientPos(e),r._previousFixedSize=r._getElementSize(r._fixedRef);var n=r._getNewFixedSize(r._previousFixedSize,r._dragAnchorPos);i!==n&&r.setState({placeholderPosition:void 0,fixedSize:n}),r._attachWindowEvents(),r._handleDragMouseEvent(e)}},r._onDividerMouseMove=function(e){r._handleDragMouseEvent(e)},r._onDividerMouseUp=function(e){r._detachWindowEvents();var t=r._getEventBoundedClientPos(e),i=r._getNewFixedSize(r._previousFixedSize,r._dragAnchorPos,t);r.setState({placeholderPosition:void 0}),r._setFixedSize(i),r._fireWindowResize()},r.events=new EventManagement,r.state={fixedSize:t.fixedSize||t.initialFixedSize,placeholderPosition:void 0,showDivider:r._shouldShowDivider(t)},r}return tslib_1.__extends(t,e),t.prototype.componentWillReceiveProps=function(e){var t=this._shouldShowDivider(e);t!==this.state.showDivider&&this.setState({showDivider:t}),this.props.fixedSize!==e.fixedSize?null!=e.fixedSize?this.setState({fixedSize:this._getNewFixedSize(e.fixedSize,0,0,e)}):null!=this.props.fixedSize&&(this.setState({fixedSize:this._getNewFixedSize(this.props.fixedSize,0,0,e)}),$DEBUG&&console.warn("Splitter: Splitter is switching from controlled mode to uncontrolled mode. You should not switched from a controlled to uncontrolled mode. Using the previous available size")):this.props.splitterDirection===e.splitterDirection&&this.props.minFixedSize===e.minFixedSize&&this.props.maxFixedSize===e.maxFixedSize||this.setState({fixedSize:this._getNewFixedSize(this.state.fixedSize,0,0,e)})},t.prototype.componentDidMount=function(){this._fireWindowResize()},t.prototype.componentWillUnmount=function(){this.events.removeAllListeners()},t.prototype.render=function(){var e=this,t=this.props,i=t.className,r=t.splitterDirection;return React.createElement("div",{className:css(i,"vss-Splitter--container",0===r&&"vss-Splitter--container-row",1===r&&"vss-Splitter--container-column",this._isDragging&&"vss-Splitter--container-dragging"),ref:function(t){return e._splitterContainer=t}},this._renderNearElement(),this._renderDivider(),this._renderDragPlaceHolder(),this._renderFarElement())},t.prototype._renderNearElement=function(){var e=this.props,t=e.fixedElement,i=e.onRenderNearElement,r=e.nearElementClassName;if(this._isDragging&&this._cachedNearElement)return this._cachedNearElement;if(this._cachedNearElement=null,i){var n=i();return this._cachedNearElement=0===t?this._renderFixedPane(n,r):this._renderFlexiblePane(n,r),this._cachedNearElement}},t.prototype._renderFarElement=function(){var e=this.props,t=e.fixedElement,i=e.onRenderFarElement,r=e.farElementClassName;if(this._isDragging&&this._cachedFarElement)return this._cachedFarElement;if(this._cachedFarElement=null,i){var n=i();return this._cachedFarElement=1===t?this._renderFixedPane(n,r):this._renderFlexiblePane(n,r),this._cachedFarElement}},t.prototype._renderFixedPane=function(e,t){var i,r=this,n=this.props,o=n.minFixedSize,s=n.maxFixedSize,a=n.splitterDirection,d=this.state.fixedSize;i=d||(null!=o?o:null!=s?s:"50%");var l=0===a?{width:i}:{height:i};if(e)return React.createElement("div",{className:css("vss-Splitter--pane-fixed",t),style:l,ref:function(e){return r._fixedRef=e}},e)},t.prototype._renderFlexiblePane=function(e,t){return React.createElement("div",{className:css("vss-Splitter--pane-flexible",t)},e)},t.prototype._renderDivider=function(){var e=this.props,t=(e.fixedElement,e.minFixedSize,e.maxFixedSize,this.state),i=t.fixedSize;if(!t.showDivider)return null;var r=this._getSplitterBoundaries(),n=r.startBound,o=r.endBound;return React.createElement("div",{"aria-valuemin":n,"aria-valuemax":o,"aria-valuenow":i,role:"separator",tabIndex:0,className:css("vss-Splitter--divider",this._isDragging&&"vss-Splitter--divider-dragging"),onKeyDown:this._onDividerKeyDown,onMouseDown:this._onDividerMouseDown})},t.prototype._renderDragPlaceHolder=function(){var e=this.props.splitterDirection,t=this.state.placeholderPosition,i=0===e?{left:t}:{top:t};if(this._isDragging)return React.createElement("div",{className:"vss-Splitter--drag-placeholder",style:i})},t.prototype._handleDragMouseEvent=function(e){var t=this.props.fixedElement,i=this.state.placeholderPosition;e.preventDefault(),e.stopPropagation();var r=this._getEventBoundedClientPos(e),n=this._getNewFixedSize(this._previousFixedSize,this._dragAnchorPos,r);n!==i&&this.setState({placeholderPosition:0===t?n:this._getElementSize(this._splitterContainer)-n-DIVIDER_WIDTH})},t.prototype._setFixedSize=function(e){var t=this.props,i=t.fixedSize,r=t.onFixedSizeChanged;null==i&&this.setState({fixedSize:e}),r&&r(e)},t.prototype._moveDivider=function(e){var t,i=this._getElementSize(this._fixedRef);switch(e){case 0:t=this._getNewFixedSize(i,DIVIDER_MOVE_INCREMENT,0);break;case 1:t=this._getNewFixedSize(i,0,DIVIDER_MOVE_INCREMENT);break;default:return}this._setFixedSize(t),this._fireWindowResize()},t.prototype._attachWindowEvents=function(){this.events.addEventListener(window,"mousemove",this._onDividerMouseMove),this.events.addEventListener(window,"mouseup",this._onDividerMouseUp)},t.prototype._detachWindowEvents=function(){this.events.removeEventListener(window,"mousemove",this._onDividerMouseMove),this.events.removeEventListener(window,"mouseup",this._onDividerMouseUp)},t.prototype._getEventBoundedClientPos=function(e){var t;switch(this.props.splitterDirection){case 0:t=e.clientX;break;case 1:t=e.clientY;break;default:t=0}return this._getBoundedClientPos(t)},t.prototype._getBoundedClientPos=function(e,t){void 0===t&&(t=this.props);t.fixedElement,t.minFixedSize,t.maxFixedSize;var i=this._getSplitterBoundaries(),r=i.startBound,n=i.endBound;return Math.max(r,Math.min(e,n))-this._getElementStartPos(this._splitterContainer,t)},t.prototype._getSplitterBoundaries=function(e){void 0===e&&(e=this.props);var t=e.fixedElement,i=e.minFixedSize,r=e.maxFixedSize;if(!this._splitterContainer)return{startBound:0,endBound:0};var n=this._getElementStartPos(this._splitterContainer,e),o=n+this._getElementSize(this._splitterContainer,e);return{startBound:0===t?i?n+i:n:r?o-r:n,endBound:0===t?r?n+r:o:i?o-i:o}},t.prototype._getNewFixedSize=function(e,t,i,r){void 0===i&&(i=t),void 0===r&&(r=this.props);var n=r.fixedElement,o=r.minFixedSize,s=void 0===o?0:o,a=r.maxFixedSize,d=void 0===a?this._getElementSize(this._splitterContainer):a,l=i-t;1===n&&(l*=-1);var p=e+l;return Math.max(s,Math.min(d,p))},Object.defineProperty(t.prototype,"_isDragging",{get:function(){return null!=this.state.placeholderPosition},enumerable:!0,configurable:!0}),t.prototype._getElementSize=function(e,t){void 0===t&&(t=this.props);switch(t.splitterDirection){case 0:return e.clientWidth;case 1:return e.clientHeight;default:return 0}},t.prototype._getElementStartPos=function(e,t){void 0===t&&(t=this.props);var i=t.splitterDirection,r=e.getBoundingClientRect();switch(i){case 0:return r.left;case 1:return r.top;default:return 0}},t.prototype._shouldShowDivider=function(e){var t=e.onRenderFarElement,i=e.onRenderNearElement;switch(e.fixedElement){case 0:return!!i;case 1:return!!t}},t.prototype._fireWindowResize=function(){var e=document.createEvent("Event");e.initEvent("resize",!1,!0),window.dispatchEvent(e)},t.defaultProps={fixedElement:1,splitterDirection:0},t}(React.Component);export{Splitter};