define(["require","exports"],function(t,e){"use strict";function r(t,e){return t?e?t.toLocaleUpperCase():t:""}function a(t,e,a){return t===e||0===r(t,a).localeCompare(r(e,a))}function s(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var r=[],a=0,s=t.length-1;a<=s;a++){var n=t[a];n&&("/"!==n||0!==a&&a!==s?(a>0&&"/"===n[0]&&(n=n.substr(1)),a<s&&"/"===n[n.length-1]&&(n=n.substr(0,n.length-1)),n&&r.push(n)):r.push(""))}return 1===r.length&&""===r[0]?"/":r.join("/")}function n(t){for(var e={segments:[]},r=-1,a=-1,s="",n=0,i=t.length;n<i;n++){var o=t.charCodeAt(n);if(r>=0){if(125===o){var h=t.substring(r,n),u=!1;42===h.charCodeAt(0)&&(h=h.substr(1),u=!0),e.segments.push({paramName:h,isWildCardParam:u}),r=-1}}else if(123===o&&123!==t.charCodeAt(n+1)){if(s||a>=0){p=s;a>=0&&(p+=t.substring(a,n)),p&&e.segments.push({text:p}),a=-1,s=""}r=n+1}else(123===o&&123===t.charCodeAt(n+1)||125===o&&125===t.charCodeAt(n+1))&&(s+=t.substring(a>=0?a:n,n+1),a=-1,n++),a<0&&(a=n)}if(a>=0||r>=0){var p;(p=s+t.substring(a>=0?a:r))&&e.segments.push({text:p})}for(var m=!1,c=e.segments.length-1;c>=0;c--){var l=e.segments[c];l.text&&"/"!==l.text?m=!0:m&&l.paramName&&(l.isRequiredParam=!0)}return e}function i(t,e){for(var r,a=Object.keys(e).length,s=0,n=t;s<n.length;s++){var i=o(n[s],e,!1);if(i&&(!r||i.matchedParametersCount>r.matchedParametersCount)&&(r=i,i.matchedParametersCount===a))return r}return r}function o(t,e,r){for(var a=[],s={},n=0,i=0,o=t.segments.length;i<o;i++){var h=t.segments[i];if(h.text){var u=h.text;r&&i>0&&"/"===u.charAt(0)&&0===a.length&&(u=u.substr(1)),u&&a.push(u)}else{var p=e[h.paramName];if(p||0===p)a.push(h.isWildCardParam?encodeURI(""+p):encodeURIComponent(""+p)),s[h.paramName]=!0,n++;else{if(!r){if(h.isRequiredParam)return;break}if(a.length){var m=a[a.length-1];"/"===m[m.length-1]&&(a[a.length-1]=m.substr(0,m.length-1))}}}}return{url:a.join(""),matchedParameters:s,matchedParametersCount:n}}Object.defineProperty(e,"__esModule",{value:!0});var h=function(){function t(t,e){this.scheme="",this.noSchemeSeparator=!1,this.host="",this.port=0,this.path="",this.queryParameters=[],this.hashString="",t&&this._setFromUriString(t,e)}return t.prototype._setFromUriString=function(t,e){var r=t,a=this._singleSplit(r,"#");a?(r=a.part1,this.hashString=this._decodeUriComponent(a.part2)):this.hashString="";var s=this._singleSplit(r,"?");s?(r=s.part1,this.queryString=s.part2):this.queryParameters=[],this.scheme="",this.host="",this.port=0,this.path="",this.noSchemeSeparator=!1;var n=this._singleSplit(r,":");if(n)if(this.scheme=n.part1,"//"===(r=n.part2).substr(0,2)){r=r.substr(2);var i=this._singleSplit(r,"/");i?(r=i.part1,this.path=i.part2):this.path="";var o=this._singleSplit(r,":");o?(this.host=o.part1,this.port=parseInt(o.part2),isNaN(this.port)&&(this.host+=":",this.path=o.part2+"/"+this.path)):this.host=r}else this.noSchemeSeparator=!0,this.path=r;else this.path=r;if(e&&e.absoluteUriRequired&&!this.scheme)throw new Error('The uri string "'+t+'" does not represent a valid absolute uri.')},t.prototype._singleSplit=function(t,e){var r=t.indexOf(e);return r>=0?{part1:t.substr(0,r),part2:t.substr(r+1)}:void 0},t.prototype._decodeUriComponent=function(t){return t&&(t=t.replace(/\+/g,"%20"),t=decodeURIComponent(t)),t},Object.defineProperty(t.prototype,"absoluteUri",{get:function(){var t="";if(this.scheme&&(t=encodeURI(decodeURI(this.scheme))+":",this.noSchemeSeparator||(t+="//")),this.host&&(t+=encodeURI(decodeURI(this.host)),this.port&&(t+=":"+this.port),this.noSchemeSeparator&&!this.path||(t+="/")),this.path){var e=void 0;if(this.noSchemeSeparator)e=encodeURI(decodeURI(this.path));else{e=this.path.split("/").map(function(t){return encodeURIComponent(decodeURIComponent(t))}).join("/")}this.host?t=s(t,e):t+=e}var r=this.queryString;if(r&&(t+="?"+r),this.hashString){var a=this._splitStringIntoParams(this.hashString);t+="#"+this._getParamsAsString(a)}return t},set:function(t){this._setFromUriString(t||"")},enumerable:!0,configurable:!0}),t.prototype.getEffectivePort=function(){return this.port?this.port:a(this.scheme,"http",!0)?80:a(this.scheme,"https",!0)?443:0},t.prototype._getParamsAsString=function(t){return t&&t.length?t.map(function(t){return null!==t.value?encodeURIComponent(t.name)+"="+encodeURIComponent(t.value):encodeURIComponent(t.name)}).join("&"):""},Object.defineProperty(t.prototype,"queryString",{get:function(){return this._getParamsAsString(this.queryParameters)},set:function(t){this.queryParameters=this._splitStringIntoParams(t)},enumerable:!0,configurable:!0}),t.prototype._splitStringIntoParams=function(t){var e=this,r=[];return t.split("&").forEach(function(t){if(t){var a=e._singleSplit(t,"=");a?r.push({name:e._decodeUriComponent(a.part1),value:e._decodeUriComponent(a.part2)}):r.push({name:e._decodeUriComponent(t),value:null})}}),r},t.prototype.getQueryParam=function(t){var e;if(this.queryParameters){var r=this.queryParameters.filter(function(e){return a(e.name,t,!0)});r.length>0&&(e=r[0].value)}return e},t.prototype.addQueryParam=function(t,e,r){r&&this.removeQueryParam(t),this.queryParameters||(this.queryParameters=[]),this.queryParameters.push({name:t,value:e})},t.prototype.addQueryParams=function(t,e,r){var a=this,s=function(s){var i=t[s];if(null!==i&&void 0!==i){var o=(r||"")+s;i instanceof Date?n.addQueryParam(o,i.toJSON(),e):Array.isArray(i)?i.forEach(function(t){return a.addQueryParam(o,""+t,e)}):"object"==typeof i?n.addQueryParams(i,e,o+"."):n.addQueryParam(o,""+i,e)}},n=this;for(var i in t)s(i)},t.prototype.removeQueryParam=function(t){this.queryParameters&&(this.queryParameters=this.queryParameters.filter(function(e){return!a(e.name,t,!0)}))},t}();e.Uri=h,e.combineUrlPaths=s,e.parseRouteTemplate=n,e.routeUrl=function(t,e){var r=i(t,e);if(!r)return"";var a=new h(r.url);for(var s in e)r.matchedParameters[s]||a.addQueryParam(s,e[s]);return a.absoluteUri},e.getBestRouteMatch=i,e.replaceParsedRouteValues=o,e.replaceRouteValues=function(t,e){return o(n(t),e,!0).url}});